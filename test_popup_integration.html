<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Popup Blocker Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <h1>Security Scanner - Popup Blocker Test</h1>
    
    <div class="test-section">
        <h2>Popup Tests</h2>
        <p>Click the buttons below to test popup blocking functionality:</p>
        
        <button onclick="testWindowOpen()">Test window.open()</button>
        <button onclick="testAlert()">Test alert()</button>
        <button onclick="testConfirm()">Test confirm()</button>
        <button onclick="testPrompt()">Test prompt()</button>
        <button onclick="testTargetBlank()">Test target="_blank"</button>
        
        <div id="testResults"></div>
    </div>
    
    <div class="test-section">
        <h2>Event Listener Test</h2>
        <p>This section listens for popup blocked events.</p>
        <div id="eventResults"></div>
    </div>

    <script>
        let blockedCount = 0;
        
        // Listen for popup blocked events
        document.addEventListener('securityScannerPopupBlocked', function(event) {
            blockedCount++;
            const eventResults = document.getElementById('eventResults');
            const result = document.createElement('div');
            result.className = 'status success';
            result.innerHTML = `
                <strong>Popup Blocked (Event #${blockedCount}):</strong><br>
                Type: ${event.detail.source}<br>
                URL: ${event.detail.url || 'N/A'}<br>
                Domain: ${event.detail.domain}<br>
                Message: ${event.detail.message || 'N/A'}
            `;
            eventResults.appendChild(result);
        });
        
        function addResult(message, isSuccess = true) {
            const results = document.getElementById('testResults');
            const result = document.createElement('div');
            result.className = `status ${isSuccess ? 'success' : 'error'}`;
            result.textContent = message;
            results.appendChild(result);
        }
        
        function testWindowOpen() {
            try {
                const popup = window.open('https://example.com', '_blank', 'width=500,height=400');
                if (popup === null) {
                    addResult('✓ window.open() was blocked (returned null)');
                } else {
                    addResult('✗ window.open() was NOT blocked', false);
                }
            } catch (error) {
                addResult('✓ window.open() threw an error: ' + error.message);
            }
        }
        
        function testAlert() {
            try {
                const result = alert('This alert should be blocked');
                if (result === undefined) {
                    addResult('✓ alert() was blocked (returned undefined)');
                } else {
                    addResult('✗ alert() was NOT blocked', false);
                }
            } catch (error) {
                addResult('✓ alert() threw an error: ' + error.message);
            }
        }
        
        function testConfirm() {
            try {
                const result = confirm('This confirm should be blocked');
                if (result === false) {
                    addResult('✓ confirm() was blocked (returned false)');
                } else {
                    addResult('✗ confirm() was NOT blocked (returned: ' + result + ')', false);
                }
            } catch (error) {
                addResult('✓ confirm() threw an error: ' + error.message);
            }
        }
        
        function testPrompt() {
            try {
                const result = prompt('This prompt should be blocked');
                if (result === null) {
                    addResult('✓ prompt() was blocked (returned null)');
                } else {
                    addResult('✗ prompt() was NOT blocked (returned: ' + result + ')', false);
                }
            } catch (error) {
                addResult('✓ prompt() threw an error: ' + error.message);
            }
        }
        
        function testTargetBlank() {
            // Create a temporary link with target="_blank"
            const link = document.createElement('a');
            link.href = 'https://example.com';
            link.target = '_blank';
            link.textContent = 'Test Link';
            link.style.display = 'none';
            document.body.appendChild(link);
            
            // Simulate click
            const event = new MouseEvent('click', {
                bubbles: true,
                cancelable: true,
                view: window
            });
            
            const wasDefaultPrevented = !link.dispatchEvent(event);
            document.body.removeChild(link);
            
            if (wasDefaultPrevented) {
                addResult('✓ target="_blank" link was blocked');
            } else {
                addResult('✗ target="_blank" link was NOT blocked', false);
            }
        }
        
        // Show initial status
        window.addEventListener('load', function() {
            const eventResults = document.getElementById('eventResults');
            eventResults.innerHTML = '<div class="status">Waiting for popup block events...</div>';
            
            setTimeout(() => {
                if (typeof window.open === 'function' && window.open.toString().includes('blockedWindowOpen')) {
                    addResult('✓ Security Scanner popup blocker detected');
                } else {
                    addResult('✗ Security Scanner popup blocker NOT detected', false);
                }
            }, 1000);
        });
    </script>
</body>
</html>
